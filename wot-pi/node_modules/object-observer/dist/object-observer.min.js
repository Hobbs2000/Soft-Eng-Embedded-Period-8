(()=>{"use strict";function e(e){return u.indexOf(e.constructor.name)>=0}function t(e,t){let o,r=s.get(e),l=y.get(r.root);return o="pop"===t?function(){let o,n,f;return o=e.length-1,(n=Reflect.apply(e[t],e,arguments))&&"object"==typeof n&&(n=p.get(n),s.get(n).revoke()),f=[new c(r.path.concat(o),n)],l.notify(f),n}:"push"===t?function(){let o,a,c,i=[];o=Array.from(arguments),c=e.length;for(let e,t=0,l=o.length;t<l;t++)(e=o[t])&&"object"==typeof e&&(o[t]=new n(e,c+t,r).proxy),i.push(new f(r.path.concat(c+t),e));return a=Reflect.apply(e[t],e,o),l.notify(i),a}:"shift"===t?function(){let o,n,f;(o=Reflect.apply(e[t],e,arguments))&&"object"==typeof o&&(o=p.get(o),s.get(o).revoke());for(let t,o=0,r=e.length;o<r;o++)(t=e[o])&&"object"==typeof t&&((f=s.get(p.get(t)))?f.ownKey=o:console.error("failed to resolve proxy -> target -> observed"));return n=[new c(r.path.concat(0),o)],l.notify(n),o}:"unshift"===t?function(){let o,a,c,i=[];(o=Array.from(arguments)).forEach(function(e,t){e&&"object"==typeof e&&(o[t]=new n(e,t,r).proxy)}),a=Reflect.apply(e[t],e,o);for(let t,o=0,r=e.length;o<r;o++)(t=e[o])&&"object"==typeof t&&((c=s.get(p.get(t)))?c.ownKey=o:console.error("failed to resolve proxy -> target -> observed"));for(let t=0,n=o.length;t<n;t++)i.push(new f(r.path.concat(t),e[t]));return l.notify(i),a}:"reverse"===t?function(){let o,r;Reflect.apply(e[t],e,arguments);for(let t,o=0,n=e.length;o<n;o++)(t=e[o])&&"object"==typeof t&&((r=s.get(p.get(t)))?r.ownKey=o:console.error("failed to resolve proxy -> target -> observed"));return o=[new function(){Object.defineProperties(this,{type:{value:"reverse"}})}],l.notify(o),this}:"sort"===t?function(){let o,r;Reflect.apply(e[t],e,arguments);for(let t,o=0,n=e.length;o<n;o++)(t=e[o])&&"object"==typeof t&&((r=s.get(p.get(t)))?r.ownKey=o:console.error("failed to resolve proxy -> target -> observed"));return o=[new function(){Object.defineProperties(this,{type:{value:"shuffle"}})}],l.notify(o),this}:"fill"===t?function(){let o,c,i,y=[],u=arguments.length,h=e.length;o=u<2?0:arguments[1]<0?h+arguments[1]:arguments[1],c=u<3?h:arguments[2]<0?h+arguments[2]:arguments[2],i=e.slice(),Reflect.apply(e[t],e,arguments);for(let t,l=o;l<c;l++)(t=e[l])&&"object"==typeof t&&(e[l]=new n(t,l,r).proxy),i.hasOwnProperty(l)?(y.push(new a(r.path.concat(l),e[l],i[l]&&"object"==typeof i[l]?p.get(i[l]):i[l])),i[l]&&"object"==typeof i[l]&&s.get(p.get(i[l])).revoke()):y.push(new f(r.path.concat(l),e[l]));return l.notify(y),this}:"splice"===t?function(){let o,i,y,u,h,b,v,g,w=[],d=e.length;g=(o=Array.from(arguments)).length;for(let e,t=0;t<g;t++)e=o[t],t>1&&e&&"object"==typeof e&&(o[t]=new n(e,t,r).proxy);h=0===g?0:o[0]<0?d+o[0]:o[0],b=g<2?d-h:o[1],v=Math.max(g-2,0),i=Reflect.apply(e[t],e,o);for(let t,o=0;o<d;o++)(t=e[o])&&"object"==typeof t&&((y=s.get(p.get(t)))?y.ownKey=o:console.error("failed to resolve proxy -> target -> observed"));for(let e,t=0,o=i.length;t<o;t++)e=i[t],b&&"object"==typeof b&&(e=p.get(b),s.get(e).revoke());for(u=0;u<b;u++)u<v?w.push(new a(r.path.concat(h+u),e[h+u],i[u])):w.push(new c(r.path.concat(h+u),i[u]));for(;u<v;u++)w.push(new f(r.path.concat(h+u),e[h+u]));return l.notify(w),i}:Reflect.get(e,t)}function o(t,o,r){let l,c=t.hasOwnProperty(o),i=t[o],u=s.get(t),h=y.get(u.root);if((l=r&&"object"==typeof r&&!e(r)?Reflect.set(t,o,new n(r,o,u).proxy):Reflect.set(t,o,r))&&(p.has(i)&&(s.get(p.get(i)).revoke(),p.delete(i)),h.hasListeners)){let e=u.path.concat(o),t=[c?new a(e,r,i):new f(e,r)];u.preventCallbacks||h.notify(t)}return l}function r(e,t){let o,r=e[t],n=s.get(e),l=y.get(n.root);if((o=Reflect.deleteProperty(e,t))&&(p.has(r)&&(s.get(p.get(r)).revoke(),p.delete(r)),l.hasListeners)){let e=[new c(n.path.concat(t),r)];n.preventCallbacks||l.notify(e)}return o}function n(l,f,a){let c,i;if(!l||"object"!=typeof l)throw new Error("Observed MUST be created from a non null object origin");if(a&&(void 0===f||null===f))throw new Error("any non-root (parent-less) Observed MUST have an own path; now parent is "+a+"; key is "+f);if(a&&!(a instanceof n))throw new Error("parent, when supplied, MUST be an instance of Observed");c=function(e){return Array.isArray(e)?e.slice():Object.assign(new e.constructor,e)}(l),Array.isArray(c)?(!function(t,o){for(let r,l=0,f=t.length;l<f;l++)(r=t[l])&&"object"==typeof r&&!e(r)&&(t[l]=new n(r,l,o).proxy)}(c,this),i=Proxy.revocable(c,{set:o,get:t,deleteProperty:r})):(!function(t,o){let r=Object.keys(t);for(let l,f,a=0,c=r.length;a<c;a++)(f=t[l=r[a]])&&"object"==typeof f&&!e(f)&&(t[l]=new n(f,l,o).proxy)}(c,this),i=Proxy.revocable(c,{set:o,deleteProperty:r})),s.set(c,this),p.set(i.proxy,c),Object.defineProperties(this,{revokable:{value:i},proxy:{value:i.proxy},parent:{value:a},ownKey:{value:f,writable:!0}})}function l(e){let t=!1,o=[];Object.defineProperties(e.proxy,{observe:{value:function(e){if(t)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer (callback) parameter MUST be a function");o.indexOf(e)<0?o.push(e):console.info("observer (callback) may be bound to an observable only once")}},unobserve:{value:function(){if(t)throw new TypeError("revoked Observable MAY NOT be unobserved amymore");if(arguments.length)for(let e,t=0,r=arguments.length;t<r;t++)(e=o.indexOf(arguments[t]))>=0&&o.splice(e,1);else o.splice(0,o.length)}},revoke:{value:function(){t?console.log("revokation of Observable have an effect only once"):(t=!0,e.revoke())}}}),Object.defineProperties(this,{hasListeners:{value:function(){return o.length>0}},notify:{value:function(e){for(let t,r=0,n=o.length;r<n;r++){t=o[r];try{t(e)}catch(e){console.error(e)}}}}})}function f(e,t){Object.defineProperties(this,{type:{value:"insert"},path:{value:e},value:{value:t}})}function a(e,t,o){Object.defineProperties(this,{type:{value:"update"},path:{value:e},value:{value:t},oldValue:{value:o}})}function c(e,t){Object.defineProperties(this,{type:{value:"delete"},path:{value:e},oldValue:{value:t}})}const i=this||window,p=new Map,s=new Map,y=new Map,u=["Date","Blob","Number","String","Boolean","Error","SyntaxError","TypeError","URIError","Function","Promise","RegExp"];Object.defineProperty(n.prototype,"root",{get:function(){let e=this;for(;e.parent;)e=e.parent;return e}}),Object.defineProperty(n.prototype,"path",{get:function(){let e=[],t=this;for(;void 0!==t.ownKey;)e.push(t.ownKey),t=t.parent;return e.reverse()}}),Object.defineProperty(n.prototype,"revoke",{value:function(){let e=this.proxy,t=Object.keys(e);for(let o,r,n=0,l=t.length;n<l;n++)r=e[o=t[n]],p.has(r)&&(s.get(p.get(r)).revoke(),p.get(e)[o]=p.get(r));this.revokable.revoke()}}),Object.defineProperty(l,"from",{value:function(t){if(!t||"object"!=typeof t)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in t||"unobserve"in t||"revoke"in t)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(e(t))throw new Error(t+" found to be one of non-observable object types: "+u);let o=new n(t),r=new l(o);return y.set(o,r),o.proxy}}),Object.defineProperty(i,"Observable",{value:l})})();